<% content_for :title do %>
  <% "OpenSplitTime: User Credentials" %>
<% end %>

<%= render "header", title: "Password" %>

<article class="ost-article container">
  <div class="row flex-nowrap">
    <%= render "sidebar" %>
    <div class="col">
      <% Connectors::Service.all.each do |service| %>
        <div class="card mt-4"
             data-controller="visibility"
             data-visibility-button-hide-class-value="btn-primary"
             data-visibility-button-hide-text-value="Hide"
             data-visibility-button-show-class-value="btn-outline-primary"
             data-visibility-button-show-text-value="Reveal">
          <div class="card-header">
            <div class="row pt-1">
              <div class="col">
                <h3><strong><%= service.name %></strong></h3>
              </div>
              <div class="col-4 col-md-2 text-end d-grid">
                <%= button_tag nil,
                               class: "btn d-none",
                               "data-action": "visibility#toggleElement",
                               "data-visibility-target": "button" %>
              </div>
            </div>
          </div>
          <div class="card-body table-responsive" data-visibility-target="element">
            <% service.credentials.each do |key| %>
              <% credential = @user.credentials.find_or_initialize_by(service_identifier: service.identifier, key: key) %>
              <%= form_with(model: credential) do |form| %>
                <%= form.hidden_field :service_identifier %>
                <%= form.hidden_field :key %>
                <div class="row">
                  <div class="col col-md-9">
                    <div class="input-group my-2 font-monospace">
                      <div class="input-group-text w-25"><%= key %></div>
                      <%= form.text_field :value, class: "px-3 w-75" %>
                    </div>
                  </div>
                  <div class="col col-md-3 my-2">
                    <%= form.submit "Save", class: "btn btn-primary" %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</article>
