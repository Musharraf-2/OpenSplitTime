<% content_for :title do %>
  <% "OpenSplitTime: User Credentials" %>
<% end %>

<%= render "header", title: "Password" %>

<article class="ost-article container">
  <div class="row flex-nowrap">
    <%= render "sidebar" %>
    <div class="col">
      <% Connectors::Service.all.each do |service| %>
        <div class="card mt-4"
             data-controller="visibility"
             data-visibility-button-hide-class-value="btn-primary"
             data-visibility-button-hide-text-value="Hide"
             data-visibility-button-show-class-value="btn-outline-primary"
             data-visibility-button-show-text-value="Reveal">
          <div class="card-header">
            <div class="row pt-1">
              <div class="col">
                <h3><strong><%= service.name %></strong></h3>
              </div>
              <div class="col-4 col-md-2 text-end d-grid">
                <%= button_tag nil,
                               class: "btn d-none",
                               "data-action": "visibility#toggleElement",
                               "data-visibility-target": "button" %>
              </div>
            </div>
          </div>
          <div class="card-body table-responsive" data-visibility-target="element">
            <% service.credentials.each do |key| %>
              <% credential = @user.credentials.find_or_initialize_by(service_identifier: service.identifier, key: key) %>
              <%= form_with(model: [:user, credential]) do |form| %>
              <div class="input-group">
                <div class="input-group-text"><%= key %></div>
                <%= form.input :value %>
              </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    <%#= form_with(model: current_user, url: user_settings_update_path, html: { method: :put, data: { controller: "form-apply" } }) do |f| %>
    <!--      <div class="col py-3">-->
    <%# if current_user.errors.any? %>
    <!--          <div id="error_explanation">-->
    <!--            <ul>-->
    <%# current_user.errors.full_messages.each do |message| %>
    <!--                <li><%#= message %></li>-->
    <%# end %>
    <!--            </ul>-->
    <!--          </div>-->
    <%# end %>

    <!--        <div class="row">-->
    <!--          <div class="col-12 col-md mb-3">-->
    <%#= f.text_area :credentials, class: "form-control", placeholder: "Paste Credentials Here" %>
    <!--          </div>-->
    <!--        </div>-->
    <!--        <div class="row">-->
    <!--          <div class="col-12 col-md mb-3">-->
    <%#= f.submit "Save Changes", class: "btn btn-primary", data: { turbo: false, "form-apply-target" => "submitButton" } %>
    <!--          </div>-->
    <!--        </div>-->
    <!--      </div>-->
    <%# end %>
  </div>
</article>
